spring:
  application:
    name: identity-service

  datasource:
    url: jdbc:postgresql://${POSTGRES_HOST:localhost}:${POSTGRES_PORT:5432}/${POSTGRES_DB:acme_identity}
    username: ${POSTGRES_USER:acme_app}
    password: ${POSTGRES_PASSWORD:acme_password}
    driver-class-name: org.postgresql.Driver

  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true

  jpa:
    hibernate:
      ddl-auto: update
    open-in-view: false
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect

  kafka:
    bootstrap-servers: ${KAFKA_BOOTSTRAP_SERVERS:localhost:9092}
    producer:
      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: org.apache.kafka.common.serialization.StringSerializer
      acks: all
      retries: 3
      properties:
        max.in.flight.requests.per.connection: 1
        enable.idempotence: true

server:
  port: ${SERVER_PORT:10300}

management:
  endpoints:
    web:
      exposure:
        include: health,info,prometheus,metrics
  endpoint:
    health:
      show-details: when_authorized
      probes:
        enabled: true

# Application-specific configuration
identity:
  password:
    argon2:
      memory: 65536  # 64 MB in KB
      iterations: 3
      parallelism: 4
      hash-length: 32
      salt-length: 16
  verification-token:
    expiration-hours: 24
  rate-limiting:
    enabled: ${RATE_LIMITING_ENABLED:true}
    registration:
      requests-per-minute: 5
    resend:
      requests-per-hour: 3
  frontend:
    base-url: ${FRONTEND_BASE_URL:https://www.acme.com}

logging:
  level:
    com.acme.identity: DEBUG
    org.springframework.kafka: INFO
